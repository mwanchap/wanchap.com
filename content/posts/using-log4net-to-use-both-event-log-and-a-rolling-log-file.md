+++
title = "Using Log4Net to use both event log and a rolling log file"
date = 2013-10-29T23:49:00Z
updated = 2013-10-29T23:50:43Z
blogimport = true 
[author]
	name = "Matt Wanchap"
	uri = "https://www.blogger.com/profile/16465307324394182190"
+++

Here's the config section, note that the&nbsp;<span style="color: #a31515; font-family: Consolas; font-size: 13px;">applicationName</span><span style="color: blue; font-family: Consolas; font-size: 13px;">&nbsp;</span>property in the&nbsp;<span style="background-color: white; color: blue; font-family: Consolas; font-size: 13px;">EventLogAppender</span>&nbsp;needs to be the same as the event source in the windows event log that you want to log to. &nbsp;If the event source doesn't exist, that appender won't work. &nbsp;In this particular project I create that during install using WiX (which is covered in another post)<br /><div><br /></div><div><span style="color: blue; font-family: Consolas; font-size: 13px;">&nbsp; &lt;</span><span style="color: #a31515; font-family: Consolas; font-size: 13px;">log4net</span><span style="color: blue; font-family: Consolas; font-size: 13px;">&nbsp;</span><span style="color: red; font-family: Consolas; font-size: 13px;">debug</span><span style="color: blue; font-family: Consolas; font-size: 13px;">=</span><span style="background-color: white; font-family: Consolas; font-size: 13px;">"</span><span style="color: blue; font-family: Consolas; font-size: 13px;">true</span><span style="background-color: white; font-family: Consolas; font-size: 13px;">"</span><span style="color: blue; font-family: Consolas; font-size: 13px;">&gt;</span><br /><div><pre style="background-color: white; background-position: initial initial; background-repeat: initial initial; font-family: Consolas; font-size: 13px;"><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: #a31515;">appender</span><span style="color: blue;">&nbsp;</span><span style="color: red;">name</span><span style="color: blue;">=</span>"<span style="color: blue;">RollingLogFileAppender</span>"<span style="color: blue;">&nbsp;</span><span style="color: red;">type</span><span style="color: blue;">=</span>"<span style="color: blue;">log4net.Appender.RollingFileAppender</span>"<span style="color: blue;">&gt;</span><br /><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: #a31515;">file</span><span style="color: blue;">&nbsp;</span><span style="color: red;">value</span><span style="color: blue;">=</span>"<span style="color: blue;">log.txt</span>"<span style="color: blue;">&nbsp;/&gt;</span><br /><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: #a31515;">datePattern</span><span style="color: blue;">&nbsp;</span><span style="color: red;">value</span><span style="color: blue;">=</span>"<span style="color: blue;">dd-MM-yyyy</span>"<span style="color: blue;">&nbsp;/&gt;</span><br /><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: #a31515;">appendToFile</span><span style="color: blue;">&nbsp;</span><span style="color: red;">value</span><span style="color: blue;">=</span>"<span style="color: blue;">true</span>"<span style="color: blue;">&nbsp;/&gt;</span><br /><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: #a31515;">locationinfo</span><span style="color: blue;">&nbsp;</span><span style="color: red;">value</span><span style="color: blue;">=</span>"<span style="color: blue;">false</span>"<span style="color: blue;">&nbsp;/&gt;</span><br /><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: #a31515;">rollingStyle</span><span style="color: blue;">&nbsp;</span><span style="color: red;">value</span><span style="color: blue;">=</span>"<span style="color: blue;">Size</span>"<span style="color: blue;">&nbsp;/&gt;</span><br /><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: #a31515;">maximumFileSize</span><span style="color: blue;">&nbsp;</span><span style="color: red;">value</span><span style="color: blue;">=</span>"<span style="color: blue;">1MB</span>"<span style="color: blue;">&nbsp;/&gt;</span><br /><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: #a31515;">maxSizeRollBackups</span><span style="color: blue;">&nbsp;</span><span style="color: red;">value</span><span style="color: blue;">=</span>"<span style="color: blue;">10</span>"<span style="color: blue;">&nbsp;/&gt;</span><br /><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: #a31515;">staticLogFileName</span><span style="color: blue;">&nbsp;</span><span style="color: red;">value</span><span style="color: blue;">=</span>"<span style="color: blue;">true</span>"<span style="color: blue;">&nbsp;/&gt;</span><br /><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: #a31515;">layout</span><span style="color: blue;">&nbsp;</span><span style="color: red;">type</span><span style="color: blue;">=</span>"<span style="color: blue;">log4net.Layout.PatternLayout</span>"<span style="color: blue;">&gt;</span><br /><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: #a31515;">conversionPattern</span><span style="color: blue;">&nbsp;</span><span style="color: red;">value</span><span style="color: blue;">=</span>"<span style="color: blue;">%-5p&nbsp;%d&nbsp;%5rms&nbsp;%-22.22c{1}&nbsp;%-18.18M&nbsp;-&nbsp;%m%n</span>"<span style="color: blue;">&nbsp;/&gt;</span><br /><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span><span style="color: #a31515;">layout</span><span style="color: blue;">&gt;</span><br /><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span><span style="color: #a31515;">appender</span><span style="color: blue;">&gt;</span><br /><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: #a31515;">appender</span><span style="color: blue;">&nbsp;</span><span style="color: red;">name</span><span style="color: blue;">=</span>"<span style="color: blue;">EventLogAppender</span>"<span style="color: blue;">&nbsp;</span><span style="color: red;">type</span><span style="color: blue;">=</span>"<span style="color: blue;">log4net.Appender.EventLogAppender</span>"<span style="color: blue;">&gt;</span><br /><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: #a31515;">applicationName</span><span style="color: blue;">&nbsp;</span><span style="color: red;">value</span><span style="color: blue;">=</span>"[<span style="color: blue;">EVENTSOURCEGOESHERE]</span>"<span style="color: blue;">&nbsp;/&gt;</span><br /><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: #a31515;">layout</span><span style="color: blue;">&nbsp;</span><span style="color: red;">type</span><span style="color: blue;">=</span>"<span style="color: blue;">log4net.Layout.PatternLayout</span>"<span style="color: blue;">&gt;</span><br /><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: #a31515;">conversionPattern</span><span style="color: blue;">&nbsp;</span><span style="color: red;">value</span><span style="color: blue;">=</span>"<span style="color: blue;">%date&nbsp;[%thread]&nbsp;%-5level&nbsp;%logger&nbsp;[%property{NDC}]&nbsp;-&nbsp;%message%newline</span>"<span style="color: blue;">&nbsp;/&gt;</span><br /><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span><span style="color: #a31515;">layout</span><span style="color: blue;">&gt;</span><br /><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span><span style="color: #a31515;">appender</span><span style="color: blue;">&gt;</span><br /><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: #a31515;">root</span><span style="color: blue;">&gt;</span><br /><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: #a31515;">level</span><span style="color: blue;">&nbsp;</span><span style="color: red;">value</span><span style="color: blue;">=</span>"<span style="color: blue;">ALL</span>"<span style="color: blue;">&nbsp;/&gt;</span><br /><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--</span><span style="color: green;">&nbsp;ALL,&nbsp;DEBUG,&nbsp;INFO,&nbsp;WARN,&nbsp;ERROR,&nbsp;FATAL,&nbsp;OFF&nbsp;</span><span style="color: blue;">--&gt;</span><br /><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: #a31515;">appender-ref</span><span style="color: blue;">&nbsp;</span><span style="color: red;">ref</span><span style="color: blue;">=</span>"<span style="color: blue;">RollingLogFileAppender</span>"<span style="color: blue;">&nbsp;/&gt;</span><br /><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;</span><span style="color: #a31515;">appender-ref</span><span style="color: blue;">&nbsp;</span><span style="color: red;">ref</span><span style="color: blue;">=</span>"<span style="color: blue;">EventLogAppender</span>"<span style="color: blue;">&nbsp;/&gt;</span><br /><span style="color: blue;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;/</span><span style="color: #a31515;">root</span><span style="color: blue;">&gt;</span><br /><span style="color: blue;">&nbsp;&nbsp;&lt;/</span><span style="color: #a31515;">log4net</span><span style="color: blue;">&gt;</span></pre><br />You can also create the event source programmatically (if that's your thing) using System.Diagnostics.EventLog, like this:<br /><pre style="background-color: white; background-position: initial initial; background-repeat: initial initial; font-family: Consolas; font-size: 13px;"><span style="color: blue;"><br /></span></pre><pre style="background-color: white; background-position: initial initial; background-repeat: initial initial; font-family: Consolas; font-size: 13px;"><span style="color: blue;">string</span>&nbsp;source&nbsp;=&nbsp;<span style="color: #a31515;">"EVENTSOURCEGOESHERE"</span>;<br /></pre><pre style="background-color: white; background-position: initial initial; background-repeat: initial initial; font-family: Consolas; font-size: 13px;"><span style="color: blue;">if</span>&nbsp;(!<span style="color: #2b91af;">EventLog</span>.SourceExists(source))<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #2b91af;">EventLog</span>.CreateEventSource(source,&nbsp;<span style="color: #a31515;">"Application"</span>);<br />}</pre></div></div>
