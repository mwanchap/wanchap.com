+++
title = "Using the Force.com CLI and Powershell"
date = 2018-04-12T19:17:00Z
updated = 2019-07-29T17:45:50Z
tags = ["Salesforce", "Powershell"]
blogimport = true 
[author]
	name = "Matt Wanchap"
	uri = "https://www.blogger.com/profile/16465307324394182190"
+++

<h3> Inserting or Updating:</h3>Put all your data into a CSV file with the exact same column headings as the Salesforce fields, again making sure to save as ASCII and not UTF8 or any other encoding (in Excel, you want the option called "CSV (Comma delimited)" not "CSV UTF-8"). And then do this: <br /><br /><code>force bulk insert Object__c .\new_object_data.csv</code><br /><br />To modify fields for updating, don't do the updates in Excel unless you have to - do it inline like this: <br /><br /><code>force query --format json "Select whatever from Object" | ConvertFrom-Json | %{$_.Some_Field__c = 'whatever'; $_} | select Id,Some_Field__c | Export-Csv .\updates.csv -NoTypeInformation -Encoding ASCII</code><br /><br />Note the following:<br />The foreach (%) block at the end it returns the object being iterated over. This is really important otherwise it won't pipe anything through to the "select".<br />Speaking of the "select", you have to select only the fields you're working with, because "force query" returns an extra "attributes" field and Salesforce will get very confused if you include it. <br /><br />Then just do the following: <br /><br /><code>force bulk update Object__c .\updates.csv</code><br /><h3>Deleting:</h3>First, write the list of records to a file (you could just save to a variable but it can come in handy to keep a list of IDs when modifying records).&nbsp; Make sure to encode the file as ASCII and remove all the quotes or Salesforce will refuse to cooperate after the next step.<br /><br /><code>force query --format csv "SELECT Id FROM Object__c WHERE Field__c = 'Whatever'" | % {$_ -replace '"', ''} | Out-File .\ids_to_delete.csv -Encoding ASCII</code><br /><br />(Big thanks to Ed over at the excellent <a href="https://blogs.technet.microsoft.com/heyscriptingguy/2011/11/02/remove-unwanted-quotation-marks-from-csv-files-by-using-powershell/" target="_blank">Hey, Scripting Guy!</a>&nbsp;blog for demonstrating this elegant way to remove the quotes)<br /><br />Or perhaps a syntactically simpler way using JSON that avoids the need for quote replacing:<br /><br /><span style="font-family: monospace;">force query --format json "SELECT Id FROM Object__c WHERE Field__c = 'Whatever'" | ConvertFrom-Json | Export-Csv .\ids_to_delete.csv -Encoding ascii -NoTypeInformation</span><br /><br />Either way, next pass that CSV to the Salesforce bulk API:<br /><br /><code>force bulk delete Object__c .\ids_to_delete.csv</code><br /><br />Or, if you just have a medium-sized list of IDs to delete and they're not in a CSV or coming from a query (e.g. copypasta from elsewhere), just paste them right into the command line as one big string and .Split() them, like this:<br /><br /><code>"axxx000000xxxxxAAA axxx000000xxxxxAAA&nbsp;etc".Split(" ") | % { force record delete Object__c $_ }</code><br /><br /><h3>Querying Metadata:</h3>For getting a list of fields, which I need to do all the time:<br /><br /><code>(force describe -t=sobject -n=Object__c | convertfrom-json).fields | select name</code><br /><br />Check out the output from just the part inside the parentheses to see all the other metadata you can use. It's easier to just make this a Powershell function and add it to your PS profile if you use this a lot, though.<br /><br /><h3>Permissions:</h3><div><div>You can query both ObjectPermissions and FieldPermissions to get the permissions of a particular profile on different things:</div><div>force query "SELECT Id, SObjectType, PermissionsRead, PermissionsCreate FROM ObjectPermissions WHERE parentid in (select id from permissionset where PermissionSet.Profile.Name = 'System Administrator')"</div></div><div><br /></div><div>For FieldPermissions it's almost the same, but the fields are slightly different and you also need to add a "WHERE SobjectType = 'Custom_Object_Name__c'"<br /><br /><h3>User Profiles:</h3></div><div>Get a count of users in each profile like this:</div><div><code>$users = force query --format json "select user.id, user.Email, user.FirstName, user.LastName, user.profile.name, user.Username, user.IsActive FROM user where user.isactive = true limit 1" | convertfrom-json<br />$users | select -expandproperty Profile | select -ExpandProperty Name | group</code><br /><code><br /></code><br /><h3>Logging into a sandbox:</h3></div><div><div>Obviously replace the domain below with the domain of your sandbox:</div><br /><code>force login -i="company--sandboxname.cs5.my.salesforce.com"</code></div>
