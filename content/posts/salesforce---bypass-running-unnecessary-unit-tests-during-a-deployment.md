+++
title = "Salesforce - bypass running unnecessary unit tests during a deployment"
date = 2018-11-09T17:00:00Z
updated = 2020-01-02T17:25:25Z
tags = ["Salesforce"]
blogimport = true 
[author]
	name = "Matt Wanchap"
	uri = "https://www.blogger.com/profile/16465307324394182190"
+++

We had to urgently fix a bug in an Apex class written by a previous colleague, which was causing major issues with a customer-facing application on a Friday afternoon (because these things always happen then).&nbsp; We'd found the bug and updated the code easily enough, but Salesforce's default deployment option of running all local unit tests was failing because of some completely unrelated tests that were failing.<br /><br />Salesforce's documentation (or at least the parts that I read) doesn't clarify that you aren't actually required to get 75% code coverage across <i>all </i>Apex code in your production org - you only need to get 75% coverage over the code you're deploying.&nbsp; Here's how to do it and get that emergency fix into production asap.<br /><br />You'll need the Force.com CLI for this, which you can easily install via chocolatey <a href="https://chocolatey.org/packages/force-cli" target="_blank">here</a>.&nbsp; You can probably do the same with the Salesforce DX CLI, but I'm used to this other one.<br /><br /><ol><li>Make a dev sandbox</li><li>In production Salesforce deployment settings, select your new sandbox and ensure "Allow inbound changes" is enabled</li><li>(in CLI) force login -i test.salesforce.com</li><li>(in CLI)&nbsp;force export src</li><li>Once the metadata export finishes, make the necessary code changes in /src/classes/</li><li>Delete every directory in /src except for /classes</li><li>Modify /src/package.xml by removing all the &lt;types&gt; nodes except the one for "ApexClass". This will make the import about a thousand times faster</li><li>(in CLI)&nbsp;force import -directory=src</li><li>Sometimes the import fails for no reason, try it again</li><li>Create an "Outbound change set" in the dev sandbox containing only the classes you changed, and upload to production</li><li>In production Salesforce, find the changes in "Inbound change sets", it should be in the "Change Sets Awaiting Deployment" section</li><li>Important: Don't deploy the change set! Click "Validate" in the details page first. On the next page, the "Validate" button will be disabled for a while. Go make a cup of tea and wait for it to become enabled (refresh the page to check).</li><li>Select "Run specified tests" and enter the names of test classes that test only what's in the deployment, then click "Validate"</li><li>Once they've passed, both the change set and the deployment should have a "Quick deploy" option.&nbsp; Click that and you're done!</li></ol><div>If your changes don't include any Apex code at all (e.g. you're just importing a bunch of reports to update a field reference), you can do it all in the production org like a hero using the below. Note that it's necessary to run just one single test, even if there's no Apex changes that require testing.</div><div><br /></div><div>force import -directory=src -r -l=RunSpecifiedTests -test=One_Test_That_Works</div>
