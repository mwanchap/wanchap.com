+++
title = "Altering User-Defined Sharing Permissions for Dynamics CRM Charts Directly in the Database"
date = 2014-01-23T22:05:00Z
updated = 2014-01-23T22:05:31Z
tags = ["T-SQL", "Dynamics CRM 2011"]
blogimport = true 
[author]
	name = "Matt Wanchap"
	uri = "https://www.blogger.com/profile/16465307324394182190"
+++

Today I received an email from a user experiencing difficulty editing charts that had been shared with them by another user, who had forgotten to check the "Write" permission. Unfortunately this person was away for the day, and for some reason CRM doesn't have a neat admin tool for managing individual user-specified sharing settings for charts and such. &nbsp;So I had little choice but to dig into the bowels of the database and set the permissions manually.<br /><br />User-designed charts are accessible via the UserQueryVisualization view and the actual permission info is stored in PrincipalObjectAccess table. The corresponding record for a specific user/chart can be obtained like this:<br /><br /><div class="MsoNormal" style="margin-bottom: 0.0001pt;"><span style="color: blue; font-family: &quot;Courier New&quot;; font-size: 10.0pt; mso-no-proof: yes;">SELECT</span><span style="font-family: &quot;Courier New&quot;; font-size: 10.0pt; mso-no-proof: yes;">&nbsp; poa<span style="color: grey;">.</span>PrincipalObjectAccessId<span style="color: grey;"><o:p></o:p></span></span></div><div class="MsoNormal" style="margin-bottom: 0.0001pt;"><span style="color: blue; font-family: &quot;Courier New&quot;; font-size: 10.0pt; mso-no-proof: yes;">FROM</span><span style="font-family: &quot;Courier New&quot;; font-size: 10.0pt; mso-no-proof: yes;">&nbsp;&nbsp;&nbsp; UserQueryVisualization uq<o:p></o:p></span></div><div class="MsoNormal" style="margin-bottom: 0.0001pt;"><span style="font-family: &quot;Courier New&quot;; font-size: 10.0pt; mso-no-proof: yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: grey;">LEFT</span> <span style="color: grey;">JOIN</span>PrincipalObjectAccess poa<o:p></o:p></span></div><div class="MsoNormal" style="margin-bottom: 0.0001pt;"><span style="font-family: &quot;Courier New&quot;; font-size: 10.0pt; mso-no-proof: yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue;">ON</span> poa<span style="color: grey;">.</span>ObjectId <span style="color: grey;">=</span> uq<span style="color: grey;">.</span>UserQueryVisualizationId<o:p></o:p></span></div><div class="MsoNormal" style="margin-bottom: 0.0001pt;"><span style="font-family: &quot;Courier New&quot;; font-size: 10.0pt; mso-no-proof: yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: grey;">LEFT</span> <span style="color: grey;">JOIN</span> SystemUserPrincipals sp<o:p></o:p></span></div><div class="MsoNormal" style="margin-bottom: 0.0001pt;"><span style="font-family: &quot;Courier New&quot;; font-size: 10.0pt; mso-no-proof: yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue;">ON</span> sp<span style="color: grey;">.</span>PrincipalId <span style="color: grey;">=</span> poa<span style="color: grey;">.</span>PrincipalId<o:p></o:p></span></div><div class="MsoNormal" style="margin-bottom: 0.0001pt;"><span style="font-family: &quot;Courier New&quot;; font-size: 10.0pt; mso-no-proof: yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: grey;">LEFT</span> <span style="color: grey;">JOIN</span> FilteredSystemUser su<o:p></o:p></span></div><div class="MsoNormal" style="margin-bottom: 0.0001pt;"><span style="font-family: &quot;Courier New&quot;; font-size: 10.0pt; mso-no-proof: yes;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="color: blue;">ON</span>su<span style="color: grey;">.</span>systemuserid <span style="color: grey;">=</span>sp<span style="color: grey;">.</span>SystemUserId<o:p></o:p></span></div><div class="MsoNormal" style="margin-bottom: 0.0001pt;"><span style="color: blue; font-family: &quot;Courier New&quot;; font-size: 10.0pt; mso-no-proof: yes;">WHERE</span><span style="font-family: &quot;Courier New&quot;; font-size: 10.0pt; mso-no-proof: yes;">&nbsp; &nbsp;uq.name <span style="color: grey;">=</span> <span style="color: red;">'Chart Name'</span></span></div><div class="MsoNormal" style="margin-bottom: 0.0001pt;"><span style="color: grey; font-family: 'Courier New'; font-size: 10pt; line-height: 107%;">AND</span><span style="font-family: 'Courier New'; font-size: 10pt; line-height: 107%;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;su<span style="color: grey;">.</span>fullname <span style="color: grey;">=</span> <span style="color: red;">'User Name'</span></span></div><div class="MsoNormal"><o:p></o:p></div><br />From there all that needs to happen is to update&nbsp;AccessRightsMask = 786455 for that PrincipalObjectAccess record. I have no idea what this value represents but it's the same value that was set on a test record which I had assigned full access to. If anyone can explain its meaning, that would be enlightening.
